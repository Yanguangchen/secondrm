<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register Interest — Second Room</title>
    <link rel="icon" href="Assets/icon.png" type="image/png" />
    <link rel="apple-touch-icon" href="Assets/icon.png" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Register Interest — Second Room" />
    <meta name="description" content="Register your interest for the Market‑Ready IR Operating System programme." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Register Interest — Second Room" />
    <meta name="twitter:description" content="Register your interest for the Market‑Ready IR Operating System programme." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="canonical" href="https://secondrm.com/register.html" />
    <!-- Google reCAPTCHA v2 (checkbox) -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
      .form-wrap {
        max-width: 820px;
        margin: 0 auto;
      }
      .sr-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 18px 24px;
        margin-top: 18px;
      }
      .sr-form .full {
        grid-column: 1 / -1;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }
      input, textarea, select {
        width: 100%;
        border: 1px solid #e3e3e3;
        border-radius: 10px;
        padding: 12px 14px;
        font-size: 1rem;
      }
      .error {
        color: #b00020;
        font-size: 0.9rem;
        min-height: 1em;
        margin-top: 4px;
      }
      .has-error {
        border-color: #b00020 !important;
        background: #fff6f6;
      }
      .smallprint {
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.5;
      }
      .checks {
        display: grid;
        gap: 10px;
        margin-top: 8px;
        justify-items: start; /* keep the checkbox+label pairs left-aligned */
      }
      .checks label { font-weight: 500; display: inline-flex; align-items: center; gap: 8px; flex-direction: row; text-align: left; }
      /* Ensure checkbox inputs don't fill the whole row like text inputs */
      .sr-form input[type="checkbox"] { width: auto; height: auto; }
      .submit-row {
        margin-top: 16px;
      }
      @media (max-width: 860px) {
        .sr-form {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-grid">
        <div class="brand">
          <a href="index.html" class="brand-link" aria-label="Second Room home">
            <img class="brand-logo" src="Assets/banner.jpg" alt="Second Room" />
          </a>
        </div>
        <button
          class="menu-toggle"
          aria-controls="primary-nav"
          aria-expanded="false"
          title="Menu"
        >
          ☰
        </button>
        <nav id="primary-nav" class="nav" aria-label="Primary">
          <button class="menu-close" aria-label="Close menu">✕</button>
          <a class="nav-link" href="index.html">Home</a>
          <a class="nav-link" href="about.html">About</a>
          <a class="nav-link" href="our-offerings.html">Our Offerings</a>
          <a class="nav-link" href="behind-sr.html">Behind SR</a>
          <a class="nav-link" href="contact.html">Contact</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="section">
        <div class="container form-wrap">
          <h1 class="service-title" style="margin-bottom: 6px;">Institutional-Grade Investor Relations: Core Build Lab </h1>
          <p class="service-subtitle">We’ll contact you with next steps and available delivery windows.</p>

          <form class="sr-form" action="#" method="post" novalidate>
            <div class="full">
              <label for="company">Company name *</label>
              <input id="company" name="company" type="text" required />
              <div id="err-company" class="error"></div>
            </div>
            <div>
              <label for="ticker">SGX ticker / code *</label>
              <input id="ticker" name="ticker" type="text" required pattern="[A-Za-z0-9.\\-]{1,10}" />
              <div id="err-ticker" class="error"></div>
            </div>
            <div>
              <label for="contactName">Contact person name *</label>
              <input id="contactName" name="contactName" type="text" required />
              <div id="err-contactName" class="error"></div>
            </div>
            <div>
              <label for="role">Contact person role *</label>
              <input id="role" name="role" type="text" required />
              <div id="err-role" class="error"></div>
            </div>
            <div>
              <label for="email">Email *</label>
              <input id="email" name="email" type="email" inputmode="email" required />
              <div id="err-email" class="error"></div>
            </div>
            <div>
              <label for="mobile">Mobile *</label>
              <input id="mobile" name="mobile" type="tel" inputmode="tel" required pattern="[0-9()+\\-\\s]{7,}" />
              <div id="err-mobile" class="error"></div>
            </div>
            <div class="full">
              <label for="office">Office location *</label>
              <input id="office" name="office" type="text" required />
              <div id="err-office" class="error"></div>
            </div>

            <div class="full">
              <div class="checks">
                <label><input type="checkbox" name="attendance" value="yes" /> CEO/CFO can attend most sessions</label>
                <label><input type="checkbox" name="contactConsent" value="yes" /> Consent to be contacted</label>
              </div>
            </div>

            <div class="full">
              <p class="smallprint">
                By submitting this form, you agree that your personal data may be collected, used, and disclosed by Second Room Pte Ltd (“Second Room”) and its authorised partners, in accordance with applicable data protection laws and regulations.
                <br /><br />
                Your information will be used to:
                <br />• Review and manage your interest in the programme
                <br />• Deliver and improve Second Room’s services
                <br />• Conduct market research and internal analysis
                <br /><br />
                We will not share your data with unrelated third parties without your consent.
              </p>
              <label style="display: inline-flex; align-items: center; gap: 8px; margin-top: 10px; flex-direction: row;">
                <input type="checkbox" name="pdpaConsent" required />
                <span><strong>I consent</strong> to the collection, use, and disclosure of my personal data by Second Room for the purposes set out in this form.</span>
              </label>
              <div id="ftr-consent" class="error"></div>
            </div>

            <div class="full" style="margin: 8px 0 6px 0;">
              <!-- reCAPTCHA v2 Checkbox -->
              <div class="g-recaptcha" data-sitekey="6Leuji4sAAAAAHc4BiPz8SOy8wBJ9IKoP-Knycp-"></div>
              <div class="smallprint" style="margin-top:6px;color:#666;">Protected by reCAPTCHA</div>
            </div>

            <div class="full submit-row">
              <button type="submit" class="button" style="border: 2px solid #000; color: #000; text-decoration: underline; padding: 14px 34px; font-weight: 700;">
                Submit Interest
              </button>
            </div>
            <div id="formStatus" class="smallprint" style="margin-top: 10px;"></div>
          </form>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">@ <span id="y"></span> Second Room Pte Ltd</div>
    </footer>
  <div class="container" style="text-align: right; margin-top: 8px; margin-bottom: 0;">
    <button id="adminSignInBtn" class="button" style="border: 1.5px solid #000; color: #000;">
      Admin sign in
    </button>
  </div>
    <script>
      document.getElementById("y").textContent = new Date().getFullYear();
      (function () {
        const btn = document.querySelector(".menu-toggle");
        const nav = document.getElementById("primary-nav");
        if (btn && nav) {
          const toggle = () => {
            const open = nav.classList.toggle("is-open");
            btn.setAttribute("aria-expanded", String(open));
            document.body.classList.toggle("no-scroll", open);
          };
          btn.addEventListener("click", toggle);
          const closeBtn = nav.querySelector(".menu-close");
          if (closeBtn)
            closeBtn.addEventListener("click", () => {
              nav.classList.remove("is-open");
              btn.setAttribute("aria-expanded", "false");
              document.body.classList.remove("no-scroll");
            });
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
              nav.classList.remove("is-open");
              btn.setAttribute("aria-expanded", "false");
              document.body.classList.remove("no-scroll");
            }
          });
        }
      })();
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import { getAnalytics, isSupported as isAnalyticsSupported } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      import { getFunctions } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-functions.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDnNp7kZbzizke0D8XVPSxtikyyQcBeBJY",
        authDomain: "secondrm.firebaseapp.com",
        projectId: "secondrm",
        storageBucket: "secondrm.firebasestorage.app",
        messagingSenderId: "468878187246",
        appId: "1:468878187246:web:3e3f336bfcaaadd71131ff",
        measurementId: "G-908P86VVVR"
      };

      const app = initializeApp(firebaseConfig);
      try {
        if (await isAnalyticsSupported()) {
          getAnalytics(app);
        }
      } catch (e) { /* ignore analytics failures */ }
      const db = getFirestore(app);
      const auth = getAuth(app);
      const ADMIN_EMAILS = new Set(["gracechen.info@gmail.com","yanguangchensp@gmail.com"]);

      const form = document.querySelector(".sr-form");
      const statusEl = document.getElementById("formStatus");
      const err = {
        company: document.getElementById("err-company"),
        ticker: document.getElementById("err-ticker"),
        contactName: document.getElementById("err-contactName"),
        role: document.getElementById("err-role"),
        email: document.getElementById("err-email"),
        mobile: document.getElementById("err-mobile"),
        office: document.getElementById("err-office"),
        pdpa: document.getElementById("ftr-consent")
      };

      function setError(input, el, msg) {
        if (input) {
          input.classList.toggle("has-error", !!msg);
        }
        if (el) {
          el.textContent = msg || "";
        }
      }

      function val(id) {
        const el = document.getElementById(id);
        return el ? el.value.trim() : "";
      }

      function validate() {
        // clear
        Object.entries({
          company: "Company name is required.",
          ticker: "Please enter SGX ticker/code.",
          contactName: "Please enter a contact name.",
          role: "Please enter a role/title.",
          email: "Please enter a valid email address.",
          mobile: "Please enter a valid mobile number.",
          office: "Please enter office location."
        }).forEach(([k]) => setError(document.getElementById(k), err[k === "pdpa" ? "pdpa" : k], ""));

        let ok = true;
        const company = val("company");
        if (!company) { setError(document.getElementById("company"), err.company, "Please enter your company name."); ok = false; }

        const ticker = val("ticker");
        if (!ticker) { setError(document.getElementById("ticker"), err.ticker, "Please enter SGX ticker/code."); ok = false; }
        else if (!/^[A-Za-z0-9.\-]{1,10}$/.test(ticker)) { setError(document.getElementById("ticker"), err.ticker, "Use 1–10 chars: A–Z, 0–9, . or -"); ok = false; }

        const contactName = val("contactName");
        if (!contactName) { setError(document.getElementById("contactName"), err.contactName, "Please enter a contact name."); ok = false; }

        const role = val("role");
        if (!role) { setError(document.getElementById("role"), err.role, "Please enter a role/title."); ok = false; }

        const email = val("email");
        if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) { setError(document.getElementById("email"), err.email, "Please enter a valid email address."); ok = false; }

        const mobileEl = document.getElementById("mobile");
        const mobileVal = mobileEl ? mobileEl.value.trim() : "";
        if (!/^[0-9()+\-\s]{7,}$/.test(mobileVal)) { setError(mobileEl, err.mobile, "Use digits, +, -, () and at least 7 numbers."); ok = false; }

        const office = val("office");
        if (!office) { setError(document.getElementById("office"), err.office, "Please enter office location."); ok = false; }

        const pdpa = document.querySelector('input[name="pdpaConsent"]');
        if (!pdpa || !pdpa.checked) { setError(null, err.pdpa, "You must consent to continue."); ok = false; }
        return ok;
      }

      form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusEl.textContent = "";
        statusEl.style.color = "";
        if (!validate()) {
          statusEl.textContent = "Please fix the highlighted fields.";
          const firstErr = document.querySelector(".has-error") || document.querySelector(".error:not(:empty)");
          if (firstErr) firstErr.scrollIntoView({ behavior: "smooth", block: "center" });
          return;
        }

        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.textContent = "Submitting…";
        try {
          // Read reCAPTCHA v2 checkbox token from the hidden textarea
          const tokenEl = document.querySelector('textarea[name="g-recaptcha-response"]');
          const token = (tokenEl && tokenEl.value ? tokenEl.value.trim() : '');
          if (!token) {
            statusEl.textContent = "Please complete the reCAPTCHA checkbox.";
            statusEl.style.color = "#b00020";
            btn.disabled = false;
            btn.textContent = "Submit Interest";
            return;
          }
          const payload = {
            company: val("company"),
            ticker: val("ticker"),
            contactName: val("contactName"),
            role: val("role"),
            email: val("email"),
            mobile: document.getElementById("mobile").value.trim(),
            office: val("office"),
            attendance: !!document.querySelector('input[name="attendance"]')?.checked,
            contactConsent: !!document.querySelector('input[name="contactConsent"]')?.checked,
            pdpaConsent: !!document.querySelector('input[name="pdpaConsent"]')?.checked,
            userAgent: navigator.userAgent,
            page: location.href
          };
          // Call HTTP function with explicit CORS headers
          // Call same-origin Vercel serverless route to avoid CORS
          const CF_URL = "/api/form/submit";
          const resp = await fetch(CF_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token, payload }),
            credentials: "omit",
          });
          if (!resp.ok) {
            const info = await resp.text().catch(() => "");
            throw new Error(`Server error (${resp.status}): ${info}`);
          }
          statusEl.textContent = "Thanks — your interest has been recorded. We’ll be in touch shortly.";
          statusEl.style.color = "green";
          form.reset();
          document.querySelectorAll(".has-error").forEach(el => el.classList.remove("has-error"));
          Object.values(err).forEach(e => e.textContent = "");
        } catch (err_) {
          console.error(err_);
          statusEl.textContent = "Sorry, something went wrong. Please try again later.";
          statusEl.style.color = "#b00020";
        } finally {
          btn.disabled = false;
          btn.textContent = "Submit Interest";
        }
      });

      // --- Admin Google Sign-in -> redirect to admin console if authorised ---
      const signInBtn = document.getElementById("adminSignInBtn");
      if (signInBtn) {
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({ prompt: "select_account" });
        signInBtn.addEventListener("click", async () => {
          try {
            const cred = await signInWithGoogle();
            const email = (cred.user && cred.user.email ? cred.user.email.toLowerCase() : "");
            if (ADMIN_EMAILS.has(email)) {
              window.location.href = "admin.html";
            } else {
              alert("This Google account is not authorised for admin access.");
              await signOut(auth);
            }
          } catch (e) {
            console.error(e);
            alert("Sign-in cancelled or failed.");
          }
        });

        function signInWithGoogle() {
          return signInWithPopup(auth, provider);
        }
      }
    </script>
  </body>
  </html>


